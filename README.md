# Mecanismo de Tradução de Credenciais de Autenticação para Portais de Negócios

Nos portais de negócios, por onde circulam informações importantes para as corporações e, muitas vezes, sigilosas, garantir o gerenciamento de identidades e a autenticação única (Single Sign On - SSO) são requisitos desejáveis. A autenticação única permite que um usuário se autentique apenas uma vez (no portal) e use desta autenticação nos demais serviços acessados via portal de negócio. Um importante requisito no contexto da autenticação única é a necessidade de tradução de credencias de autenticação, ou seja, prover um suporte a autenticação SSO mesmo diante de parceiros que usem diferentes tecnologias de segurança. Este trabalho teve por objetivo prover a autenticação única para portais de negócio do tipo marketplace, mesmo diante de credenciais de autenticação heterogêneas, através de um mecanismo de autenticação e de tradução de credenciais. O método de experimentação foi empregado através do desenvolvimento e avaliação de um protótipo que envolve o mecanismo de autenticação e tradução de credenciais proposto baseado em Serviços Web. Com base nas especificações de segurança de Serviços Web (SAML e WS-Trust) e na especificação OPENID 2.0 a arquitetura do protótipo foi definida. Nesta arquitetura, quando um usuário tenta acessar um serviço disponibilizado no portal, caso este ainda não esteja autenticado, o portal disponibiliza a página de autenticação para que este indique o seu provedor de identidade OpenID. Através do mecanismo de redirecionamento do HTTP, o usuário realiza a autenticação em seu provedor e em seguida sua credencial de autenticação se torna disponível no portal. Caso o serviço que esteja sendo solicitado, exija um certificado digital para autenticar o usuário, o serviço responsável pela tradução de credenciais (STS –Security Token Service) é acionado pelo portal para que uma nova credencial (X.509) seja gerada e para que esta seja repassada para o serviço, conforme a especificação WS-Security.  Para a construção do protótipo foram utilizados os seguintes softwares de código aberto: o ambiente de desenvolvimento NetBeans, os frameworks METRO, JSF e RichFaces para desenvolvimento de Serviços Web, Aplicação Web e Interface Web, respectivamente, e os servidores de aplicação Glassfish e Tomcat. A fim de verificar a aplicabilidade do mecanismo de autenticação e de tradução de credenciais proposto, foi desenvolvido um portal de agência de viagens, que possibilita a seus usuários a consulta de informações e a reserva de recursos de hotéis, empresas aéreas e locadoras de veículos, disponibilizando desta maneira um mecanismo flexível para criação de pacotes de viagens em uma única aplicação Web. JSF e RichFaces foram utilizados para compor a camada View do Portal, segundo o padrão de projetos MVC. O framework METRO foi o utilizado para a implementação do Serviço Web do Hotel e para implementação do cliente de WS que está no portal. A especificação OpenID, utilizada para autenticação de usuário no portal, é considerada complexa, porém o  Openid4java é uma implementação da especificação de autenticação OpenID que visa  torna simples o uso da autenticação OpenID. Os resultados obtidos com o protótipo comprovam as vantagens que a autenticação única oferece para os usuários de portais de negócios. A implementação do serviço de tradução de credenciais ainda requer aprimoramentos para que os provedores de serviços do portal possam suportar diferentes credenciais de autenticação e não somente certificados digitais e credenciais OpenID.

PALAVRAS-CHAVE: Portal de negócios, Autenticação única, Tradução de credenciais.

## Implementação do Protótipo
Esta etapa de implementação foi divida em três atividades conforme descritas a seguir:
### Implementação de um Portal de Negócios
A fim de verificar a aplicabilidade do mecanismo de autenticação e de tradução de credenciais proposto, um portal web foi desenvolvido em linguagem Java (plataforma Java EE 6), sendo que em sua concepção foram utilizados os frameworks JSF e METRO e a biblioteca RichFaces.. Escolheu-se desenvolver um portal de uma agência de viagens por ser uma aplicação que possibilita a seus usuários (clientes), através de um sua interface web, a consulta de informações e a reserva de recursos de hotéis, empresas aéreas e locadoras de veículos, disponibilizando desta maneira um mecanismo flexível para criação de pacotes de viagens em uma única aplicação. 
JSF e RichFaces foram utilizados para compor a camada View do Portal, segundo o padrão de projetos MVC. O framework METRO foi o utilizado para a implementação do Serviço Web do Hotel e na implementação do cliente de WS que está no portal.
O framework Metro, componente do projeto Glassfish da Oracle 9, possui um extenso conjunto de bibliotecas que podem ser facilmente estendidas e implementa padrões e especificações apropriadas ao gerenciamento de identidades. Estas características o destaca como uma importante opção a ser considerada no desenvolvimento de aplicativos que incluam o gerenciamento de identidades entre seus recursos. A importância do framework Metro no cenário de Serviços Web está ligado ao fato deste conter em seu conjunto de bibliotecas, “implementações de referência” de diversas especificações da plataforma Java. Dentre estas, destaca-se a especificação JAX-WS - Java API for XML Web Services - que define as bases da criação de serviços Web com foco na linguagem Java que e é parte da plataforma Java EE da Oracle.
No protótipo, os serviços web desenvolvidos, como por exemplo, o de reserva de hotéis (projeto ServicoHotelWS) estão no servidor de aplicação GlassFish, já o portal Web da Agência de Viagens (projeto  PortalServiceWS) foi implantado no Container Web Tomcat.
Nesta etapa, nenhum mecanismo de autenticação ou de tradução de credenciais foi implantado.

### Integração da Autenticação OpenID no Portal de Negócios
A especificação OpenID é considerada complexa, porém o  Openid4java é uma implementação da especificação de autenticação OpenID que visa  torna simples o uso da autenticação OpenID. No protótipo, um usuário, para acessar os serviços disponibilizados através do portal da agência de viagens, precisará passar pela autenticação SSO conforme a especificação OpenID. Os métodos implementados relacionados ao  OpenID, que são da biblioteca openid4java, estão localizados na classe Java OpenIdControl (localizada no control). Essa classe contém cinco métodos que correspondem ao uso da API openid4java: 
* getReturnToUrl () retorna a URL que o navegador redirecionará após autenticação do usuário no provedor OpenID
* getConsumerManager () é usado para obter uma instância da classe principal API openid4java.
* performDiscoveryOnUserSuppliedIdentifier () lida com eventuais problemas que surgem durante o processo de descoberta. 
* createOpenIdAuthRequest () cria a construção AuthRequest que é necessário para fazer a autenticação. 

### Implementação do Serviço Tradutor de Credenciais
O framework METRO oferece mecanismos para prover segurança para Serviços Web, dentre estes, destacam-se: WS-Policy; XWSS - XML and Web Services Security - responsável pela implementação da especificação WS-Security; e WSIT - Web Services Interoperability Technologies. responsável pela implementação das seguintes especificações: WS-Trust, WS-SecurityConversation, WS-SecurityPolicy, entre outras.
O framework Metro fornece toda funcionalidade básica para construção de um STS, definido na WS-Trust, por meio da classe BaseSTSImpl. Essa classe, por padrão, permite a emissão de asserções SAML 1.1 e 2.0. A implementação é extensível por meio das seguintes interfaces: STSTokenProvider, para suportar outros tipos de credenciais; STSAttributeProvider, para obter atributos de fontes variadas; e STSAuthorizationProvider, para emitir credenciais e declarações de autorização.
As mensagens trocadas pelo STS são bastante gerais para permitir extensões e composições futuras, cabendo a cada operação (emissão, validação, renovação, revogação, etc.) especificar quais elementos a mensagem deve conter. A mensagem de requisição é composta de um elemento XML RequestSecurityToken (RST) e a resposta é formada pelo RequestSecurityTokenResponse (RSTR). A RST contém parâmetros gerais, como o tipo de requisição, o tipo de credencial ao qual a requisição se refere, o serviço ao qual a credencial será apresentada e as exigências desse serviço. No protótipo, esta conterá os atributos obtidos do processo de autenticação OpenID. A RSTR contém, basicamente, a credencial requisitada juntamente com parâmetros da credencial (tipo, validade, contexto de utilização, etc.) descritos de forma independente do tipo de credencial, no caso do protótipo, é uma asserção SAMLv.2.

## Avaliação do Protótipo
Durante o desenvolvimento do protótipo, testes de unidade foram realizados. OS erros encontrados foram corrigidos e os testes foram refeitos. Alguns testes de integração foram realizados, porém, com o protótipo não foi 100% finalizado, alguns asos de testes previstos não foram executados, dente estes, os testes de desempenho.

## Documentação e Divulgação de Resultados
Os relatórios parciais, alguns resumos dos estudos realizados e o presente relatório foram redigidos nesta etapa. Pretende-se ainda até o final deste mês de Julho redigir um artigo para ser submetido em um evento nacional de iniciação científica e o resumo que será submetido para o evento de iniciação científica da UNIVALI.

## CONSIDERAÇÕES FINAIS
O uso de portais de negócios na Internet têm apresentado um crescimento muito acentuado nos últimos anos (BELLAS, 2004). Para a realização de transações comerciais através de portais de negócio, por onde circulam informações importantes para as corporações e, muitas vezes, sigilosas, estabelecer o gerenciamento de identidades entre os parceiros envolvidos e traduzir credenciais de autenticação utilizadas na composição são necessidades críticas.
O mecanismo de segurança desenvolvido neste projeto oferece meios que auxiliam clientes e provedores de serviços no gerenciamento de identidades (ou credenciais) e na tradução de credencias de autenticação. Um protótipo do mecanismos de autenticação única e de tradução de credenciais foi desenvolvido, porém este ainda não está totalmente concluído. O mecanismos de tradução de credencias (STS) ainda não está totalmente funcional, porém é possível que este possa ser concluído até o final do mês de julho ou em agosto.
Destaca-se que o cronograma de implementação da solução proposta atrasou devido alguns problemas e desafios que o bolsista enfrentou no decorrer de sua pesquisa. Dentre estes, destacam-se: (1) pouca bibliografia em português e, como o aluno possui dificuldades em ler em inglês, a etapa de estudo bibliográfico foi concluída com atraso, (2)  apesar de ter um bom conhecimento em Java, o bolsista não conhecia os framework JSF e METRO, o que exigiu um bom tempo para o desenvolvimento do portal de negócios e dos serviços web, (3) a tecnologia OpenID não possui documentação em português e, poucos exemplos foram encontrados que utilizavam a biblioteca openid4J, por fim, (4)  o aluno encontrou muita dificuldade no desenvolvimento do serviço de tradução de credenciais a partir do STS, uma vez que para esta etapa da implementação muitas bibliotecas que não eram conhecidas pelo bolsista precisaram ser utilizadas (WSIT e openSAML).

## SUGESTÕES PARA DESDOBRAMENTO DA PESQUISA
O mecanismo de segurança desenvolvido neste projeto deve prover meios que auxiliem clientes e provedores de serviços no gerenciamento de identidades (ou credenciais) e na tradução de credencias de autenticação. O modelo e o protótipo desenvolvido se concentraram em somente duas tecnologias de autenticação, OpenID e SAML.  O protótipo não foi finalizado, logo a primeira sugestão é finalizá-lo para que os testes possas sem concluídos. Constata-se que o serviço responsável para tradução de credenciais necessita ser aprimorado para tratar outras credencias de autenticação como certificados X.509 e os InformationCards.
Outro ponto importante é que o mecanismo proposto ainda não contempla todas as necessidades exigidas em portais de negócios, como por exemplo, lidar com um processo de negócio executável (CARMINATI et al., 2005, MELLO et al, 2009). É importante que a criação sob demanda e customizada de processos de negócios (composição dinâmica de Serviços Web), realizada nos portais, seja ciente da segurança, levando em conta os riscos de segurança e os requisitos de todos os parceiros envolvidos (provedores e requisitantes), expressos em suas políticas de segurança. É desejável que processos de negócios não deixem de ser realizados por falta de compatibilidade das credenciais de autenticação entre os parceiros envolvidos.


